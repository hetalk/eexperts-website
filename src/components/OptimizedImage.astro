---
/*
 * Optimized Image Component
 * Last Updated: 2025-09-16 08:19:10 IST
 *
 * Features:
 * - Automatic format selection (WebP/AVIF with fallbacks)
 * - Responsive images with multiple sizes
 * - Lazy loading
 * - Proper aspect ratio maintenance
 * - SEO-friendly alt text
 */

import { Image } from 'astro:assets';

export interface Props {
  src: string;
  alt: string;
  width?: number;
  height?: number;
  sizes?: string;
  class?: string;
  loading?: 'lazy' | 'eager';
  quality?: number;
  format?: 'webp' | 'avif' | 'jpeg' | 'png';
}

const {
  src,
  alt,
  width = 800,
  height = 600,
  sizes = '(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw',
  class: className = '',
  loading = 'lazy',
  quality = 80,
  format = 'webp'
} = Astro.props;

// Generate multiple widths for responsive images
const widths = [400, 800, 1200, 1600];
const aspectRatio = width / height;
---

<Image
  src={src}
  alt={alt}
  width={width}
  height={height}
  widths={widths}
  sizes={sizes}
  loading={loading}
  quality={quality}
  format={format}
  class={`transition-opacity duration-300 ${className}`}
  style={`aspect-ratio: ${aspectRatio};`}
/>

<style>
  img {
    object-fit: cover;
    width: 100%;
    height: auto;
  }

  img[loading="lazy"] {
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
  }

  img[loading="lazy"].loaded {
    opacity: 1;
  }
</style>

<script>
  // Progressive image loading
  document.addEventListener('DOMContentLoaded', () => {
    const images = document.querySelectorAll('img[loading="lazy"]');

    const imageObserver = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const img = entry.target as HTMLImageElement;

          img.addEventListener('load', () => {
            img.classList.add('loaded');
          });

          if (img.complete) {
            img.classList.add('loaded');
          }

          observer.unobserve(img);
        }
      });
    });

    images.forEach(img => imageObserver.observe(img));
  });
</script>